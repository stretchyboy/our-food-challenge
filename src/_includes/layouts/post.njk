---
layout: layouts/base.njk
templateClass: tmpl-home
---

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsvectormap/1.4.3/css/jsvectormap.css" integrity="sha512-R/p6hEdcHJdQ5967L0K8A4wO2xyg5SDgFrESWemL+GhQR5EIJ2fsNEnvzEKgr2MCRNgNEJwVQIKDQ68cThxQpg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jsvectormap/1.4.3/js/jsvectormap.min.js" integrity="sha512-qIjvxoJojZ64SLBuklyHGh7Bmc0CXhp0KhsDD19y8q935nh/KgHIpJbXcsoZlzzR2Wf78CpH34jiclEqzZ8quQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsvectormap/1.4.3/maps/world.js" integrity="sha512-fzlKic/RyjgLIbkRywhW3cYwiI+XgcslngfOzC+p/2D5OBDvJQkp56pBRcfvj7Rd471B4UnweDMBGcPetMse1A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

{# This is the template for individual blog postsâ€“it builds the front matter properties into the page #}

<div class="wrapper post">
  <div class="postContent">
    {# The post front matter includes the title property #}
    <h1 class="postTitle">{{title}}</h1>
    
    <br /> 
    
    <div class="postMedia">
      <div class="postMediaItem postFlagWrap">
        <img class="postFlag" src="https://flagcdn.com/h240/{{iso | lower}}.png" alt="Flag of {{ title }}" />
      </div>
      <div id="mapBox" class="postMediaItem postMapWrap">
        <div id="country-map" class="postMap"></div>
      </div>
    </div>
    
    {# ADD P ELEMENT FROM TODO ON THE NEXT LINE #}
    
    <p>
      <a target="_blank" href="https://en.wikipedia.org/wiki/{{title}}">Wikipedia</a>
      <a target="_blank" href="https://www.google.com/search?q={{title}}+national+dish">National Dish</a>
      <a target="_blank" href="https://www.tasteatlas.com/most-popular-dishes-in-{{title | lower | replace(' ', '-') }}">Most Popular</a>
      <a target="_blank" href="https://www.google.com/maps/search/?api=1&query={{title | replace(' ', '+') }}+traditional+restaurants">Restaurants</a>
      <a target="_blank" href="https://www.google.com/search?q={{title | replace(' ', '+') }}+traditional+drinks">Drinks</a>
    </p>

    {% set issueFood = issueFoods[page.url] %}
    {% set acceptedRecipes = issueFood.accepted if issueFood and issueFood.accepted else [] %}
    {% set suggestedRecipes = issueFood.suggestions if issueFood and issueFood.suggestions else [] %}

    {% set contentParts = content | splitFirstParagraph %}
    {{ contentParts.lead | safe }}
    
    
    {% if acceptedRecipes %}
    <h3>
      Planned recipes
    </h3>    
    <ul>
      {%- for dish in acceptedRecipes -%}
        <li>
          {% if dish.name %}
            {% if dish.url %}
            <a target="_blank" href="{{dish.url}}">{{dish.name}}</a>
            {% else %}
            {{dish.name}}
            {% endif %}
          {% else %}
          Recipe
          {% endif %}
          - <a target="_blank" href="{{dish.issueUrl}}">Issue #{{dish.issueNumber}}</a>
          {% if dish.displayLabels and dish.displayLabels.length %}
          - Labels: {{ dish.displayLabels | join(', ') }}
          {% endif %}
      </li>
      {%- endfor -%}
    </ul>
  
    {% endif %}
   {% if suggestedRecipes %}
    <h3>
      Recipe suggestions
    </h3>
    <ul>
      
      {%- for dish in suggestedRecipes -%}
        {% set dishName = dish.name if dish.name else 'Recipe' %}
        <li>{{dishName}} -
          <a target="_blank" href="{{dish.issueUrl}}">Issue #{{dish.issueNumber}}</a>
          {% if dish.displayLabels and dish.displayLabels.length %}
          - Labels: {{ dish.displayLabels | join(', ') }}
          {% endif %}
            {% if dish.url and ('glitch.me' not in (dish.url | lower)) %}
          - <a target="_blank" href="{{dish.url}}">Source</a>
          {% endif %}
      </li>
      {%- endfor -%}
    </ul>
    {% endif %}
    
    
    {# Content from the body of the post markdown appears here #}
    {{ contentParts.rest | safe }}

    <div class="issueStarter">
      <p><strong>Suggest a recipe</strong></p>
      <p>
        <a
          target="_blank"
          rel="noopener"
          href="https://github.com/stretchyboy/our-food-challenge/issues/new?template=recipe-suggestion.yml&labels=recipe-suggestion&country_path={{ page.url }}"
        >
          Open recipe suggestion form
        </a>
      </p>
      <form id="recipe-issue-form" class="recipeIssueForm" data-country-path="{{ page.url }}" data-country-title="{{ title }}">
        <label for="recipe-issue-name">Recipe name</label>
        <input id="recipe-issue-name" name="recipeName" type="text" placeholder="Conch salad" />

        <label for="recipe-issue-course">Course</label>
        <select id="recipe-issue-course" name="course">
          <option value="starter">starter</option>
          <option value="main" selected>main</option>
          <option value="dessert">dessert</option>
        </select>

        <label for="recipe-issue-url">Source URL (optional)</label>
        <input id="recipe-issue-url" name="sourceUrl" type="url" placeholder="https://example.com/recipe" />

        <fieldset>
          <legend>Dietary tags</legend>
          <label><input type="checkbox" name="dietary" value="vegetarian" /> vegetarian</label>
          <label><input type="checkbox" name="dietary" value="vegan" /> vegan</label>
          <label><input type="checkbox" name="dietary" value="fish" /> fish</label>
          <label><input type="checkbox" name="dietary" value="shellfish" /> shellfish</label>
          <label><input type="checkbox" name="dietary" value="gluten-free" /> gluten-free</label>
          <label><input type="checkbox" name="dietary" value="onion-free" /> onion-free</label>
        </fieldset>

        <label><input type="checkbox" name="requiresAdaptation" value="requires-adaptation" /> requires-adaptation</label>
        <label for="recipe-issue-adaptation-notes">Adaptation notes (optional)</label>
        <textarea id="recipe-issue-adaptation-notes" name="adaptationNotes" rows="3" placeholder="What would need to change?"></textarea>

        <button type="submit">Start issue from this page</button>
      </form>
    </div>

    <script>
(() => {
  const form = document.getElementById("recipe-issue-form")
  if (!form) return

  form.addEventListener("submit", event => {
    event.preventDefault()

    const countryPath = form.dataset.countryPath || ""
    const countryTitle = form.dataset.countryTitle || ""

    const recipeName = (form.elements.recipeName?.value || "").trim()
    const course = (form.elements.course?.value || "main").trim()
    const sourceUrl = (form.elements.sourceUrl?.value || "").trim()
    const adaptationNotes = (form.elements.adaptationNotes?.value || "").trim()

    const dietaryTags = Array.from(form.querySelectorAll('input[name="dietary"]:checked'))
      .map(input => input.value)

    const requiresAdaptation = Boolean(form.elements.requiresAdaptation?.checked)
    const labels = ["recipe-suggestion", course, ...dietaryTags]
    if (requiresAdaptation) {
      labels.push("requires-adaptation")
    }

    const dietaryBody = dietaryTags.length
      ? dietaryTags.map(tag => `- [x] ${tag}`).join("\\n")
      : "- [ ] vegetarian\\n- [ ] vegan\\n- [ ] fish\\n- [ ] shellfish\\n- [ ] gluten-free\\n- [ ] onion-free"

    const adaptationBody = requiresAdaptation
      ? "- [x] requires-adaptation"
      : "- [ ] requires-adaptation"

    const issueBody = [
      "### Country page path",
      countryPath,
      "",
      "### Recipe name",
      recipeName || `${countryTitle} recipe`,
      "",
      "### Source URL",
      sourceUrl || "",
      "",
      "### Course",
      course,
      "",
      "### Dietary tags",
      dietaryBody,
      "",
      "### Adaptation",
      adaptationBody,
      "",
      "### Adaptation notes",
      adaptationNotes || "",
      "",
      "### Why this recipe?",
      `Candidate recipe for ${countryTitle}.`,
    ].join("\\n")

    const params = new URLSearchParams()
    params.set("template", "recipe-suggestion.yml")
    params.set("labels", Array.from(new Set(labels)).join(","))
    params.set("country_path", countryPath)
    params.set("course", course)
    params.set("recipe_name", recipeName)
    params.set("title", `Recipe suggestion: ${recipeName || `${countryTitle} recipe`}`)
    params.set("rationale", `Candidate recipe for ${countryTitle}.`)
    if (dietaryTags.length) {
      params.set("dietary", dietaryTags.join(", "))
    }
    if (requiresAdaptation) {
      params.set("adaptation", "requires-adaptation")
    }
    if (adaptationNotes) {
      params.set("adaptation_notes", adaptationNotes)
    }

    if (sourceUrl) {
      params.set("source_url", sourceUrl)
    }
    params.set("body", issueBody)

    window.open(`https://github.com/stretchyboy/our-food-challenge/issues/new?${params.toString()}`, "_blank", "noopener")
  })
})()
    </script>
    
    <script>
const map = new jsVectorMap({
  selector: '#country-map',
  map: 'world',
  backgroundColor: '#dff0ff',
  selectedRegions: ['{% if mapRegion %}{{ mapRegion | upper }}{% else %}{{ iso | upper }}{% endif %}'],
{% if mapFocus and mapFocus.coords %}
  focusOn: {
    coords: [{{ mapFocus.coords[0] }}, {{ mapFocus.coords[1] }}],
    scale: {% if mapFocus.scale %}{{ mapFocus.scale }}{% else %}6{% endif %},
    animate: true
  },
  markers: [{
    coords: [{{ mapFocus.coords[0] }}, {{ mapFocus.coords[1] }}],
    name: '{{ title }}'
  }],
{% else %}
  focusOn: {
    region: '{% if mapRegion %}{{ mapRegion | upper }}{% else %}{{ iso | upper }}{% endif %}',
    animate: true
  },
{% endif %}
  regionStyle: {
    initial: { fill: '#4f6b7a', stroke: '#ffffff', strokeWidth: 0.25 },
    hover: { fill: '#3f5865' },
    selected: { fill: 'red' },
    selectedHover: { fill: 'purple' }
  },
  zoomOnScroll: false,
  zoomButtons: false,
  panOnDrag: false
})
    </script>
    
    <div class="controls">
    {# The previous and next post data is added in .eleventy.js #}
    {% if prevPost.url %}
      <p>
        <strong>Previous post</strong>: 
        <a class="previous" href="{{ prevPost.url }}">{{ prevPost.data.title }}</a>
      </p>
    {% endif %}
    {% if nextPost.url %}
      <p>
        <strong>Next post</strong>: 
        <a class="next" href="{{ nextPost.url }}">{{ nextPost.data.title }}</a>
      </p>
    {% endif %}
    </div>

    <section class="comments">
      <h3>Comments</h3>
      <script
        src="https://utteranc.es/client.js"
        repo="stretchyboy/our-food-challenge"
        issue-term="pathname"
        label="comments"
        theme="github-light"
        crossorigin="anonymous"
        async>
      </script>
    </section>
  </div>
  
  
</div>
